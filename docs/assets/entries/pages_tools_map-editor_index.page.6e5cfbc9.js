import{c as st,C as ye,w as It,S as we}from"../chunks/chunk-e8c0938d.js";import{u as y,_ as ke,p as Tt,T as G,h as Gt}from"../chunks/chunk-e21ef82c.js";import{a as Lt,n as Se,b as $e}from"../chunks/chunk-fe10f5e1.js";function xe(t){const{variant:e="neutral"}=t,r="pv0 ph1 f4 lh-copy pointer bn br2";return e==="neutral"?y("button",{className:st(r,"relative bg-animate bg-white hover-bg-black black hover-white"),onClick:t.onClick,children:[y("span",{className:"absolute absolute--fill ba br2 b--black"}),t.title]}):y("button",{className:st(r,"dim white",e==="positive"&&"bg-dark-green",e==="negative"&&"bg-dark-red"),onClick:t.onClick,children:t.title})}function Ft(t,e){const r=document.createElement("canvas");return r.width=t,r.height=e,r}function Me(t){if(t==null)return null;const e=Ft(t.naturalWidth,t.naturalHeight);return e.getContext("2d").drawImage(t,0,0),e.toDataURL()}function Ht(t){if(t==null)return null;const e=new window.Image;return e.src=t,e}function B(t,e,r,n){const o=Math.floor(r+n),s=Math.floor(t/o),c=Math.floor(e/o),i=t%o,l=e%o,a=Math.round(i/2),u=Math.round(l/2),m=t+a-i,f=e+u-l;return{step:o,horizontalTiles:s,verticalTiles:c,startX:a,startY:u,endX:m,endY:f}}function qt(t){return t.width=t.clientWidth,t.height=t.clientHeight,t.getContext("2d")}function Jt(t){Lt(t.charAt(0)==="c");const e=t.substring(1).split("|").map(r=>parseInt(r,10));return Lt(e.length===2),e}function Ct(t){return`c${t[0]}|${t[1]}`}function Ot(t,e,r){if(t==null)return null;const n=Ft(r,r),o=n.getContext("2d"),{step:s,horizontalTiles:c,verticalTiles:i}=B(t.width,t.height,e,r),l=[];for(let a=0;a<i;++a){const u=[];l.push(u);for(let m=0;m<c;++m){o.clearRect(0,0,r,r),o.drawImage(t,m*s,a*s,r,r,0,0,r,r);const f=n.toDataURL();u.push(f)}}return l}function ze(t,e,r){const n=qt(t);if(e===0)return;const{width:o,height:s}=t,{startX:c,startY:i,endX:l,endY:a}=B(o,s,e,r);n.globalAlpha=.5,n.lineWidth=e,n.strokeStyle="#ccc",n.beginPath();for(let u=c;u<o;u+=e+r)n.moveTo(u,i),n.lineTo(u,a);for(let u=i;u<s;u+=e+r)n.moveTo(c,u),n.lineTo(l,u);n.stroke(),n.globalAlpha=1}function Ne(t,e){const r=qt(t),n=e.asset;if(n==null)return;const{width:o,height:s}=t;if(e.viewEditor){const{map:c,scale:i,gridSize:l,gutterSize:a,tileSize:u}=e,m=Math.floor(u*i),{step:f,startX:h,startY:w}=B(o,s,l,m),p=a+u;Object.keys(c).forEach(d=>{const[v,b]=c[d],[$,k]=Jt(d),S=Math.floor($*f+h+l/2),g=Math.floor(k*f+w+l/2);r.drawImage(n,v*p,b*p,u,u,S,g,m,m)})}else{const{gridSize:c,gutterSize:i,tileSize:l}=e,a=Math.floor(l*e.scale),{horizontalTiles:u,verticalTiles:m,step:f,startX:h,startY:w,endX:p,endY:x}=B(o,s,c,a),{horizontalTiles:d,verticalTiles:v,step:b}=B(n.naturalWidth,n.naturalHeight,i,l),$=Math.floor(Math.floor(Math.max((u-d)/2,0))*f+.5*c+h),k=Math.floor(Math.floor(Math.max((m-v)/2,0))*f+.5*c+w);for(let S=0;S<d;S++){const g=S*f+$;if(g>p)break;for(let z=0;z<v;z++){const Y=z*f+k;if(Y>x)break;r.drawImage(n,S*b,z*b,l,l,g,Y,a,a)}}}}function Ie(t,e){for(const r in t)e(t[r],r)}function N(t,e){t.forEach(e)}function I(t,e,r){if(!t)throw Error(`${r?r+": ":""}${e}`)}function D({node:t=[],from:e,source:r,parent:n=e||r,to:o,target:s,child:c=o||s,scope:i={},meta:l={},family:a={type:"regular"},regional:u}={}){const m=rt(n),f=rt(a.links),h=rt(a.owners),w=[];N(t,x=>x&&E(w,x));const p={id:Ye(),seq:w,next:rt(c),meta:l,scope:i,family:{type:a.type||"crosslink",links:f,owners:h}};return N(f,x=>E(ut(x),p)),N(h,x=>E(ft(x),p)),N(m,x=>E(x.next,p)),u&&P&&ae(H(P),[p]),p}function Kt(t,e,r){let n,o=T,s=null,c=M;if(t.target&&(e=t.params,r=t.defer,n=t.meta,o="page"in t?t.page:o,t.stack&&(s=t.stack),c=et(t)||c,t=t.target),c&&M&&c!==M&&(M=null),Array.isArray(t))for(let w=0;w<t.length;w++)A("pure",o,R(t[w]),s,e[w],c,n);else A("pure",o,R(t),s,e,c,n);if(r&&!nt)return;const i={isRoot:nt,currentPage:T,scope:M,isWatch:vt,isPure:at};let l,a,u,m,f,h;nt=0;t:for(;m=Ge();){const{idx:w,stack:p,type:x}=m;u=p.node,T=f=p.page,M=et(p),f?h=f.reg:M&&(h=M.reg);const d=!!f,v=!!M,b={fail:0,scope:u.scope};l=a=0;for(let $=w;$<u.seq.length&&!l;$++){const k=u.seq[$];if(k.order){const{priority:S,barrierID:g}=k.order,z=g?f?`${f.fullID}_${g}`:g:0;if($!==w||x!==S){g?bt.has(z)||(bt.add(z),xt($,p,S,g)):xt($,p,S,0);continue t}g&&bt.delete(z)}switch(k.type){case"mov":{const g=k.data;let z;switch(g.from){case"stack":z=H(p);break;case"a":case"b":z=p[g.from];break;case"value":z=g.store;break;case"store":if(h&&!h[g.store.id])if(d){const Y=ce(f,g.store.id);p.page=f=Y,Y?h=Y.reg:v?(V(M,g.store,0,1,g.softRead),h=M.reg):h=void 0}else v&&V(M,g.store,0,1,g.softRead);z=ie(h&&h[g.store.id]||g.store)}switch(g.to){case"stack":p.value=z;break;case"a":case"b":p[g.to]=z;break;case"store":Fe(f,M,g.target,0).current=z}break}case"compute":const S=k.data;if(S.fn){vt=u.meta.op==="watch",at=S.pure;const g=S.safe?(0,S.fn)(H(p),b.scope,p):qe(b,S.fn,p);S.filter?a=!g:p.value=g,vt=i.isWatch,at=i.isPure}}l=b.fail||a}if(!l){const $=H(p),k=et(p);if(N(u.next,S=>{A("child",f,S,p,$,k)}),k){u.meta.needFxCounter&&A("child",f,k.fxCount,p,$,k),u.meta.storeChange&&A("child",f,k.storeChange,p,$,k),u.meta.warnSerialize&&A("child",f,k.warnSerializeNode,p,$,k);const S=k.additionalLinks[u.id];S&&N(S,g=>{A("child",f,g,p,$,k)})}}}nt=i.isRoot,T=i.currentPage,M=et(i)}function Te(t,e){let r,n;const o=t;if(e){const s=Ae(e);t.length===0?(r=s.path,n=s.fullName):(r=s.path.concat([t]),n=s.fullName.length===0?t:s.fullName+"/"+t)}else r=t.length===0?[]:[t],n=t;return{shortName:o,fullName:n,path:r}}function Qt(t,e){if(!e||!e.name&&!e.named&&!e.loc)return t;let r=`[${t}]`;const n=e.named||e.name;n&&(r+=` unit '${n}'`);const o=e.loc;return!n&&o&&(r+=` (${o.file}:${o.line}:${o.column})`),r}function St(t){const e=()=>t();return e.unsubscribe=()=>t(),e}function F(t,...e){const r=oe();if(r){const n=r.handlers[t];if(n)return n(r,...e)}}function C(t,e){const r=Z({or:e,and:typeof t=="string"?{name:t}:t}),n=Qt("event",r),o=(i,...l)=>(I(!q(o,"derived"),"call of derived event is not supported, use createEvent instead",n),I(!at,"unit call from pure function is not supported, use operators like sample instead",n),T?((a,u,m,f)=>{const h=T;let w=null;if(u)for(w=T;w&&w.template!==u;)w=K(w);Vt(w);const p=a.create(m,f);return Vt(h),p})(o,s,i,l):o.create(i,l)),s=oe(),c=Object.assign(o,{graphite:D({meta:fe(r.actualOp||"event",o,r),regional:1}),create:i=>(Kt({target:o,params:i,scope:M}),i),watch:i=>ue(o,i),map:i=>yt(o,"map",i,[L()]),filter:i=>yt(o,"filter",i.fn?i:i.fn,[L(pt,1)]),filterMap:i=>yt(o,"filterMap",i,[L(),$t(l=>!J(l),1)]),prepend(i){I(o.targetable,".prepend of derived event is not supported, call source event instead",n);const l=C("* → "+o.shortName,{parent:K(o)});return F("eventPrepend",R(l)),Xt(l,o,[L()],"prepend",i),Je(o,l),l}});return r!=null&&r.domain&&r.domain.hooks.event(c),_(c,"id",c.graphite.id),ne(c.graphite),c}function Bt(t,e,r,n,o){return Be(r,`${o} ${e}`,"first argument"),I(X(n),"second argument should be a function",o),lt(!q(t,"derived"),`${e} in derived store`,`${e} in store created via createStore`,o),N(Array.isArray(r)?r:[r],s=>{t.off(s),ct(t).set(s,le(de(s,t,"on",Ue,n)))}),t}function Zt(t,e){const r=Z(e),n=je(t),o=Qt("store",r),s=C({named:"updates",derived:1});F("storeBase",n);const c=n.id,i="skipVoid"in r,l=i&&!r.skipVoid;lt(!(i&&r.skipVoid),"{skipVoid: true}","updateFilter",o);const a={subscribers:new Map,updates:s,defaultState:t,stateRef:n,getState(){let d,v=n;if(T){let b=T;for(;b&&!b.reg[c];)b=K(b);b&&(d=b)}return!d&&M&&(V(M,n,1),d=M),d&&(v=d.reg[c]),ie(v)},setState:d=>Kt({target:a,params:d,defer:1,scope:M}),reset:(...d)=>(I(a.targetable,".reset of derived store is not supported",o),N(d,v=>Bt(a,".reset",v,()=>a.defaultState,o)),a),on:(d,v)=>(I(a.targetable,".on of derived store is not supported",o),Bt(a,".on",d,v,o)),off(d){const v=ct(a).get(d);return v&&(v(),ct(a).delete(d)),a},map(d,v){let b,$;W(d)&&(b=d,d=d.fn);const k=a.getState(),S=J(k);(!S||S&&l)&&($=d(k));const g=Zt($,{name:`${a.shortName} → *`,derived:1,...v,and:b}),z=de(a,g,"map",pt,d);return _e(it(g),{type:"map",fn:d,from:n}),it(g).noInit=1,F("storeMap",n,z),g},watch(d,v){if(lt(!v,"watch second argument","sample",o),!v||!te(d)){const b=ue(a,d);return F("storeWatch",n,d)||d(a.getState()),b}return I(X(v),"second argument should be a function",o),d.watch(b=>v(a.getState(),b))}},u=fe("store",a,r),m=a.defaultConfig.updateFilter;a.graphite=D({scope:{state:n,fn:m},node:[$t((d,v,b)=>(b.scope&&!b.scope.reg[n.id]&&(b.b=1),d)),We(n),$t((d,v,{a:b,b:$})=>{const k=J(d);return k&&!i&&console.error(`${o}: ${wt}`),(k&&l||!k)&&(d!==b||$)},1),m&&L(Pe,1),mt({from:"stack",target:n})],child:s,meta:{...u,defaultState:t},regional:1}),_(a,"id",a.graphite.id),_(a,"rootStateRefId",c);const f=q(a,"serialize"),h=q(a,"derived"),w=f==="ignore",p=q(a,"sid");p&&(_(a,"storeChange",1),n.sid=p),p||w||h||_(a,"warnSerialize",1);const x=J(t);return I(h||!x||x&&l,wt,o),h&&x&&!i&&console.error(`${o}: ${wt}`),ae(a,[s]),r!=null&&r.domain&&r.domain.hooks.store(a),h||(a.reinit=C({named:"reinit"}),a.reset(a.reinit)),n.meta=a.graphite.meta,ne(a.graphite),a}function Ce({unit:t,fn:e,scope:r,batch:n}){const o=[ot.run({fn:c=>e(c)})];n&&o.unshift(ot.compute({priority:"sampler",batch:1})),dt(t)&&o.unshift(ot.mov({store:t.stateRef,to:"stack"}));const s=Array.isArray(t)?t:[t];if(r){const c=[],i=r.additionalLinks;return s.forEach(l=>{const a=i[l.graphite.id]||[];i[l.graphite.id]=a;const u=D({node:Re(o,l),meta:{watchOp:l.kind}});a.push(u),c.push(()=>{const m=a.indexOf(u);m!==-1&&a.splice(m,1),Nt(u)})}),St(()=>{c.forEach(l=>l())})}{const c=D({node:o,parent:s,family:{owners:s}});return St(()=>{Nt(c)})}}function Re(t,e){return dt(e)?[ot.mov({store:e.stateRef,to:"stack"}),...t]:t}const Ee=typeof Symbol<"u"&&Symbol.observable||"@@observable",R=t=>t.graphite||t,ut=t=>t.family.owners,ft=t=>t.family.links,it=t=>t.stateRef,H=t=>t.value,ct=t=>t.subscribers,K=t=>t.parent,et=t=>t.scope,q=(t,e)=>R(t).meta[e],_=(t,e,r)=>R(t).meta[e]=r,Ae=t=>t.compositeName,te=t=>(X(t)||W(t))&&"kind"in t,ee=t=>e=>te(e)&&e.kind===t,dt=ee("store"),De=ee("domain"),ht=(t,e)=>{const r=t.indexOf(e);r!==-1&&t.splice(r,1)},E=(t,e)=>t.push(e),lt=(t,e,r,n)=>!t&&console.error(`${n?n+": ":""}${e} is deprecated${r?`, use ${r} instead`:""}`),Rt=()=>{let t=0;return()=>""+ ++t},Xe=Rt(),re=Rt(),Ye=Rt();let P=null;const ne=t=>{},oe=()=>P,Le=t=>(t&&P&&P.sidRoot&&(t=`${P.sidRoot}|${t}`),t),ae=(t,e)=>{const r=R(t);N(e,n=>{const o=R(n);r.family.type!=="domain"&&(o.family.type="crosslink"),E(ut(o),r),E(ft(r),o)})},rt=(t=[])=>(Array.isArray(t)?t:[t]).flat().map(R),W=t=>typeof t=="object"&&t!==null,X=t=>typeof t=="function",J=t=>t===void 0,Oe=t=>I(W(t)||X(t),"expect first argument be an object"),Pt=(t,e,r,n)=>I(!(!W(t)&&!X(t)||!("family"in t)&&!("graphite"in t)),`${e}: expect ${r} to be a unit (store, event or effect)${n}`),Be=(t,e,r)=>{Array.isArray(t)?N(t,(n,o)=>Pt(n,e,`${o} item of ${r}`,"")):Pt(t,e,r," or array of units")},Pe=(t,{fn:e},{a:r})=>e(t,r),Ue=(t,{fn:e},{a:r})=>e(r,t),pt=(t,{fn:e})=>e(t),se=(t,e,r,n)=>{const o={id:re(),type:t,data:e};return r&&(o.order={priority:r},n&&(o.order.barrierID=++Ve)),o};let Ve=0;const mt=({from:t="store",store:e,target:r,to:n=r?"store":"stack",batch:o,priority:s})=>se("mov",{from:t,store:e,to:n,target:r},s,o),Q=({fn:t,batch:e,priority:r,safe:n=0,filter:o=0,pure:s=0})=>se("compute",{fn:t,safe:n,filter:o,pure:s},r,e),Et=({fn:t})=>Q({fn:t,priority:"effect"}),$t=(t,e,r)=>Q({fn:t,safe:1,filter:e,priority:r&&"effect"}),We=(t,e,r)=>mt({store:t,to:e?"stack":"a",priority:r&&"sampler",batch:1}),L=(t=pt,e)=>Q({fn:t,pure:1,filter:e}),ot={mov:mt,compute:Q,filter:({fn:t,pure:e})=>Q({fn:t,filter:1,pure:e}),run:Et},je=t=>({id:re(),current:t,initial:t}),ie=({current:t})=>t,_e=(t,e)=>{t.before||(t.before=[]),E(t.before,e)};let O=null;const At=(t,e)=>{if(!t)return e;if(!e)return t;let r;return(t.v.type===e.v.type&&t.v.id>e.v.id||Mt(t.v.type)>Mt(e.v.type))&&(r=t,t=e,e=r),r=At(t.r,e),t.r=t.l,t.l=r,t},Dt=[];let Ut=0;for(;Ut<6;)E(Dt,{first:null,last:null,size:0}),Ut+=1;const Ge=()=>{for(let t=0;t<6;t++){const e=Dt[t];if(e.size>0){if(t===3||t===4){e.size-=1;const n=O.v;return O=At(O.l,O.r),n}e.size===1&&(e.last=null);const r=e.first;return e.first=r.r,e.size-=1,r.v}}},A=(t,e,r,n,o,s,c)=>xt(0,{a:null,b:null,node:r,parent:n,value:o,page:e,scope:s,meta:c},t,0),xt=(t,e,r,n)=>{const o=Mt(r),s=Dt[o],c={v:{idx:t,stack:e,type:r,id:n},l:null,r:null};o===3||o===4?O=At(O,c):(s.size===0?s.first=c:s.last.r=c,s.last=c),s.size+=1},Mt=t=>{switch(t){case"child":return 0;case"pure":return 1;case"read":return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},bt=new Set;let M,nt=1,vt=0,at=0,T=null;const Vt=t=>{T=t},ce=(t,e)=>{if(t){for(;t&&!t.reg[e];)t=t.parent;if(t)return t}return null},Fe=(t,e,r,n)=>{const o=ce(t,r.id);return o?o.reg[r.id]:e?(V(e,r,n),e.reg[r.id]):r},He=t=>t,V=(t,e,r,n,o)=>{const s=t.reg;if(s[e.id])return;const c=e.sid,i={id:e.id,current:e.initial,meta:e.meta};if(i.id in t.values.idMap)i.current=t.values.idMap[i.id];else if(c&&c in t.values.sidMap&&!(c in t.sidIdMap)){var l;const a=e==null||(l=e.meta)===null||l===void 0?void 0:l.serialize;i.current=(t.fromSerialize&&a!=="ignore"&&(a==null?void 0:a.read)||He)(t.values.sidMap[c])}else if(e.before&&!o){let a=0;const u=r||!e.noInit||n;N(e.before,m=>{switch(m.type){case"map":{const f=m.from;if((f||m.fn)&&(f&&V(t,f,r,n),u)){const h=f&&s[f.id].current;i.current=m.fn?m.fn(h):h}break}case"field":V(t,m.from,r,n),a||(a=1,i.current=Array.isArray(i.current)?[...i.current]:{...i.current}),u&&(i.current[m.field]=s[s[m.from.id].id].current)}})}c&&(t.sidIdMap[c]=e.id),s[e.id]=i},qe=(t,e,r)=>{try{return e(H(r),t.scope,r)}catch(n){console.error(n),t.fail=1,t.failReason=n}},Z=(t,e={})=>(W(t)&&(Z(t.or,e),Ie(t,(r,n)=>{J(r)||n==="or"||n==="and"||(e[n]=r)}),Z(t.and,e)),e),Wt=(t,e)=>{ht(t.next,e),ht(ut(t),e),ht(ft(t),e)},zt=(t,e,r)=>{let n;t.next.length=0,t.seq.length=0,t.scope=null;let o=ft(t);for(;n=o.pop();)Wt(n,t),(e||r&&t.meta.op!=="sample"||n.family.type==="crosslink")&&zt(n,e,n.meta.op!=="on"&&r);for(o=ut(t);n=o.pop();)Wt(n,t),r&&n.family.type==="crosslink"&&zt(n,e,n.meta.op!=="on"&&r)},j=t=>t.clear(),Nt=(t,{deep:e}={})=>{let r=0;if(t.ownerSet&&t.ownerSet.delete(t),dt(t))j(ct(t));else if(De(t)){r=1;const n=t.history;j(n.events),j(n.effects),j(n.stores),j(n.domains)}zt(R(t),!!e,r)},le=t=>St(()=>Nt(t)),Xt=(t,e,r,n,o)=>D({node:r,parent:t,child:e,scope:{fn:o},meta:{op:n},family:{owners:[t,e],links:e},regional:1}),ue=(t,e)=>(I(X(e),".watch argument should be a function"),le(D({scope:{fn:e},node:[Et({fn:pt})],parent:t,meta:{op:"watch"},family:{owners:t},regional:1}))),Je=(t,e,r="event")=>{K(t)&&K(t).hooks[r](e)},fe=(t,e,r)=>{const n=Z(r),o=t==="domain",s=Xe(),{sid:c=null,named:i=null,domain:l=null,parent:a=l}=n,u=i||n.name||(o?"":s),m=Te(u,a),f={op:e.kind=t,name:e.shortName=u,sid:e.sid=Le(c),named:i,unitId:e.id=s,serialize:n.serialize,derived:n.derived,config:n};return e.targetable=!n.derived,e.parent=a,e.compositeName=m,e.defaultConfig=n,e.getType=()=>(lt(0,"getType","compositeName.fullName"),m.fullName),!o&&(e.subscribe=h=>(Oe(h),e.watch(X(h)?h:w=>h.next&&h.next(w))),e[Ee]=()=>e),f},yt=(t,e,r,n)=>{let o;W(r)&&(o=r,r=r.fn);const s=C({name:`${t.shortName} → *`,derived:1,and:o});return Xt(t,s,n,e,r),s},wt="undefined is used to skip updates. To allow undefined as a value provide explicit { skipVoid: false } option",de=(t,e,r,n,o)=>{const s=it(e),c=mt({store:s,to:"a",priority:"read"});r==="map"&&(c.data.softRead=1);const i=[c,L(n)];return F("storeOnMap",s,i,dt(t)&&it(t)),Xt(t,e,i,r,o)};D({node:[Et({fn:({fn:t,value:e})=>t(e)})],meta:{op:"fx",fx:"sidechain"}});const pe=C(),me=C(),ge=C(),he=C(),Yt=C(),tt=Zt({asset:null,map:{},scale:2,gridSize:2,gutterSize:1,tileSize:16,viewEditor:!0},{name:"map-editor"}).on(pe,t=>({...t,viewEditor:!t.viewEditor})).on(me,t=>({...t,gridSize:Se(t.gridSize,[0,2,4])})).on(ge,(t,e)=>({...t,asset:e})).on(he,(t,[e,r])=>({...t,map:{...t.map,[e]:r}})).on(Yt,(t,e)=>({...t,...e}));function Ke(){const t=$e(Ht("/tilemap-kenney.png"));t.onload=()=>{const e=[[[0,0],[9,4]],[[1,0],[10,4]],[[2,0],[11,4]],[[3,0],[12,4]],[[4,0],[13,4]],[[0,1],[9,5]],[[1,1],[10,5]],[[2,1],[11,5]],[[3,1],[12,5]],[[4,1],[13,5]],[[5,1],[14,5]],[[0,2],[9,6]],[[1,2],[10,6]],[[2,2],[11,6]],[[3,2],[12,6]],[[4,2],[13,6]],[[0,3],[9,3]],[[1,3],[10,3]],[[2,3],[10,3]],[[3,3],[10,3]],[[4,3],[13,3]]].reduce((s,[c,i])=>(s[Ct(c.map(l=>l+5))]=i,s),{});Yt({asset:t,map:e,gutterSize:1,tileSize:16,viewEditor:!0})}}function Qe(t){return y("div",{className:"cf ph2 mb2",children:[y("h2",{className:"mv2 f4 fw4 lh-copy",children:"Демо"}),y(xe,{onClick:Ke,title:"Загрузить"}),y("p",{className:"f6 mv1 dark-gray",children:"Загрузить пример карты с kenney.nl"})]})}function be(t,e){const r=ke(null);return Tt(()=>{const n=r.current;n!=null&&t(n,...e)},e),r}function gt(t){const e=G(o=>Ce({unit:t,fn:o}),[t]),r=G(()=>t.getState(),[t]);return ye(e,r)}function Ze(t){const{scale:e,gridSize:r,tileSize:n}=gt(tt),o=Math.floor(n*e),s=be(ze,[r,o]);return y("canvas",{className:"w-100 h-100 absolute",ref:s})}const tr=It(Ze);function kt(t){const{position:e}=t;return y("button",{className:st("bn br2 bg-white-20 hover-bg-moon-gray pointer",e!=null&&"absolute",e==="bottom-left"&&"bottom-1 left-1",e==="bottom-right"&&"bottom-1 right-1",e==="top-left"&&"top-1 left-1",e==="top-right"&&"top-1 right-1"),onClick:t.onClick,children:y("img",{className:"db",src:t.asset})})}function ve(t,...e){return function(n){let o=0;s(n);function s(c){const i=o===0?t:e[o-1];if(typeof i=="function")try{o++,i(c,s)}catch(l){console.error(l)}}}}function er(t,e){U(t);for(const r of t.dataTransfer.items){if(r.kind!=="file"||!r.type.startsWith("image"))return;const n=r.getAsFile(),o=window.URL.createObjectURL(n);t.stopPropagation(),e(o)}}function rr(t,e){const r=document.createElement("img");r.onload=()=>e(r),r.src=t}function U(t){t.preventDefault()}function nr(t){const e=gt(tt),r=be(Ne,[e]);return console.log(e),y("canvas",{className:"w-100 h-100 absolute",onDragEnter:U,onDragOver:U,onDrop:ve(function(o,s){U(o);const{width:c,height:i}=o.target,{scale:l,gridSize:a,tileSize:u}=e;for(const m of o.dataTransfer.items){if(m.kind!=="string")return;m.getAsString(f=>{const h=Jt(f),{startX:w,startY:p,step:x}=B(c,i,a,l*u),d=Math.floor((o.clientX-w)/x),v=Math.floor((o.clientY-p)/x),b=Ct([d,v]);s([b,h])})}},he),ref:r})}const or=It(nr);function ar(t){const{isShown:e,position:r="right"}=t,n=r==="right"?"100%":"-100%";return y("div",{className:st("pv2 h-100 overflow-y-auto bg-white b--mid-gray absolute top-0",r==="left"&&"br left-0",r==="right"&&"bl right-0"),style:{transform:`translateX(${e?"0":n})`,transition:"transform 0.2s ease-out",width:"13rem"},children:t.children})}function sr(){return y("span",{className:"dib mr1"})}function ir(t){const e=Math.ceil(32/t);return Math.max(1,e)}function cr(t){const e=t.target,{x:r,y:n}=e.dataset,o=Ct([r,n]);t.dataTransfer.setData("text/plain",o)}function lr(t,e,r){const[n,o]=Gt(Ot(t,e,r));return Tt(()=>{o(Ot(t,e,r))},[t,e,r]),n}function ur(t){const{asset:e,gutterSize:r,tileSize:n}=gt(tt),o=lr(e,r,n),s=ir(n),c=o!=null?o.map((i,l)=>i.map((a,u)=>y("img",{className:"fl mr1 mb1 pointer","data-x":u,"data-y":l,draggable:!0,onDragStart:cr,src:a,style:{width:n*s+"px",height:n*s+"px"}},u+l*i.length))):null;return y("div",{className:"cf pl2 pr1",children:[y("h2",{className:"mv2 f4 fw4 lh-copy",children:"Тайлы"}),c]})}const fr=It(ur);function dr(t){window.localStorage.removeItem(t)}function jt(t,e){window.localStorage.setItem(t,e)}function pr(t){const e=window.localStorage.getItem(t);if(typeof e!="string")return null;switch(e.charAt(0)){case"j":return JSON.parse(e.substring(1));case"s":return e.substring(1);default:return null}}function mr(t,e){if(e==null){dr(t);return}switch(typeof e){case"object":jt(t,"j"+JSON.stringify(e));break;case"string":jt(t,"s"+e);break}}function _t(t=!1){const[e,r]=Gt(t);return{setFalse:G(()=>r(!1),[]),setTrue:G(()=>r(!0),[]),setValue:r,toggle:G(()=>r(n=>!n),[]),value:e}}const gr="/assets/static/edit-20.ccb19d1f.svg",hr="/assets/static/grid-20.8478d94b.svg",br="/assets/static/map-20.426d6c0d.svg",vr="/assets/static/sidebar-20.d4dda39b.svg",Sr={title:"map editor | jsalterego.im"};function $r(){const{viewEditor:t}=gt(tt),{setTrue:e,value:r}=_t(!1),{toggle:n,value:o}=_t(!0);return Tt(()=>{const s=pr("map-editor");if(s!=null){const[c,i,l,a]=s,u=Ht(c);Yt({asset:u,map:i,gutterSize:l,tileSize:a})}window.addEventListener("beforeunload",function(){const c=tt.getState();mr("map-editor",[Me(c.asset),c.map,c.gutterSize,c.tileSize])}),e()},[]),y(we,{flex:!0,wholeScreenHeight:!0,children:[y("div",{className:"flex-auto bg-light-purple",onDragEnter:U,onDragOver:U,onDrop:ve(er,rr,ge),children:[y(tr,{}),r&&y(or,{})]}),y(ar,{isShown:r&&o,children:[y(fr,{}),y(Qe,{})]}),y("div",{className:"absolute bottom-1 left-1",children:[y(kt,{asset:t?br:gr,onClick:pe}),y(sr,{}),y(kt,{asset:hr,onClick:me})]}),y(kt,{asset:vr,onClick:n,position:"top-right"})]})}export{$r as Page,Sr as documentProps};
