import{w,N,c as className,S as Section}from"../chunks/chunk-e8c0938d.js";import{i as isObject}from"../chunks/chunk-fe10f5e1.js";import{u,h,g,T,_,p}from"../chunks/chunk-e21ef82c.js";import{d as debounce}from"../chunks/chunk-f99a2322.js";const control="pv2 ph3 w-100 ba b--black-70 im--control";function parse(input){typeof input=="string"&&(input.startsWith('"{\\"')?input=JSON.parse(input):input.startsWith('{\\"')&&(input=JSON.parse(`"${input}"`)));try{return JSON.parse(input)}catch(e){if(e instanceof SyntaxError&&(e.message.startsWith("JSON Parse error: Property name must be a string literal")||e.message.startsWith("Expected double-quoted property name in JSON at position")||e.message.startsWith("JSON Parse error: Expected '}'")||e.message.startsWith("Expected property name or '}' in JSON at position")))return eval(`(${input})`);throw e}}const escape={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"};function toString(s){if(s==null)return"null";switch(typeof s){case"boolean":return String(s);case"number":return String(s);case"string":{let n="";for(let t=0;t<s.length;++t){const r=s[t];escape[r]!=null?n+=escape[r]:n+=r}return`"${n}"`}default:return""}}function traverse(s,n){const t={isClosingBracket:!1,isOpeningBracket:!1,isLast:!0,level:0,line:0,path:[]};(function r(c,b){if(isObject(c)){const l=Array.isArray(c),i=t.isLast,d=t.path.length;t.isOpeningBracket=!0,t.line++,n(l?"[":"{",b,t),t.isOpeningBracket=!1,t.level+=1,Object.keys(c).forEach((o,m,a)=>{t.isLast=m===a.length-1,t.path[d]=o,r(c[o],l?null:o)}),t.isClosingBracket=!0,t.isLast=i,t.level-=1,t.path[d]!=null&&t.path.pop(),t.line++,n(l?"]":"}",null,t),t.isClosingBracket=!1}else t.line++,n(toString(c),b,t)})(s,null)}const jsonarea="",Jsonarea=w(N(function s(n,t){const{value:r}=n,[c,b]=useFoldState(),l=typeof r=="string"?r:[];return Array.isArray(l)&&traverse(r,(i,d,o)=>{const m=o.path.join("."),a=c.some(k=>m===k),f=c.some(k=>m!==k&&m.startsWith(k));if(a&&o.isClosingBracket||f)return;const v=d!=null&&(o.isOpeningBracket?u(g,{children:[u("span",{className:className(c.includes(m)?"folded":"unfolded","foldstatus underline-hover light-red pointer"),onClick:()=>b(m),children:['"',d,'"']}),":"," "]}):u(g,{children:[u("span",{className:"light-red",children:['"',d,'"']}),": "]})),S=a?i==="["?"[..]":"{..}":i;l.push(u("pre",{className:"mv1 pl4 line pre-wrap monospace","data-line":o.line,children:["  ".repeat(o.level),v,S,!(o.isLast||o.isOpeningBracket&&!a)&&","]}))}),u("div",{className:className(control,"overflow-auto bg-near-white near-black f5 code",n.className),onDblClick:i=>{if(window.getSelection){i.preventDefault();const d=document.createRange();d.selectNode(t.current);const o=window.getSelection();o.removeAllRanges(),o.addRange(d)}},onScroll:n.onScroll,ref:t,tabindex:"0",children:l})}));function useFoldState(){const[s,n]=h([]);return[s,t=>{s.includes(t)?n(s.filter(r=>r!==t)):n(s.concat(t))}]}const Textarea=N(function s(n,t){return u("textarea",{autoCapitalize:"off",autoCorrect:"off",className:className(control,"overflow-auto f5 code",n.className),onChange:n.onChange,onScroll:n.onScroll,placeholder:n.placeholder,ref:t,rows:n.rows,style:{resize:"vertical"},value:n.value})}),edit2Icon="/assets/static/edit-2-16.b28a4785.svg",fileTextIcon="/assets/static/file-text-16.28d50d9c.svg";function useBoolean(s=!1){const[n,t]=h(s);return{setFalse:T(()=>t(!1),[]),setTrue:T(()=>t(!0),[]),setValue:t,toggle:T(()=>t(r=>!r),[]),value:n}}function useDebounce(s,n){return _(debounce(s,n)).current}function useTargetValue(s=""){const[n,t]=h(s),r=T(c=>t(c.currentTarget.value),[]);return[n,r]}const documentProps={title:"json | jsalterego.im"};function Page(){const{toggle:s,value:n}=useBoolean(),[t,r]=useTargetValue(),[c,b]=h(),l=_(null),i=_(null),d=useDebounce(a=>{var v,S;const f=a.target.scrollTop;switch(a.target){case l.current:(v=i.current)==null||v.scroll(0,f);break;case i.current:(S=l.current)==null||S.scroll(0,f);break}}),o=useDebounce(a=>{try{a.trim()===""?b():b(parse(a))}catch(f){b(f.message)}});p(()=>{o(t)},[t]),p(()=>{return document.addEventListener("keydown",a,!0),()=>document.removeEventListener("keydown",a,!0);function a(f){f.key==="Escape"&&s()}}),p(()=>{var a,f;n?document.activeElement===i.current&&((a=l.current)==null||a.focus()):document.activeElement===l.current&&((f=i.current)==null||f.focus())},[n]);const m=u("div",{className:"relative f5",children:[u(Jsonarea,{className:className("absolute absolute--fill",n?"z-1":"z-0"),onScroll:d,ref:l,value:c}),u(Textarea,{className:className("db relative",n?"z-0":"z-1"),onChange:r,onScroll:d,placeholder:"Введи json строку",ref:i,rows:27,value:t}),u("button",{className:"pv1 ph2 ba br2 b--black-70 bg-white absolute right-2 top-1 z-2",onClick:s,children:u("img",{className:"db",src:n?fileTextIcon:edit2Icon})})]});return u(Section,{wholeScreenHeight:!0,children:[u("h1",{className:"mw8 mv3 ph3 center",children:"Json Prettier"}),u("div",{className:"mw8 mv3 ph3 center",children:m})]})}export{Page,documentProps};
